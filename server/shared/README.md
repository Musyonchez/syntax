# SyntaxMem Shared Utilities

**Simple, Uniform, Consistent** utilities shared across all serverless functions.

## ğŸ¯ Purpose

This directory contains production-ready utilities that all serverless functions use:
- **Authentication** âœ… JWT token creation, verification, and user management
- **Database** âœ… MongoDB connection with async Motor driver
- **Response formatting** âœ… Consistent API response structure
- **Security** âœ… Input sanitization and validation helpers

## ğŸ“ Files Status

### `auth_utils.py` âœ… PRODUCTION READY
JWT token management for authentication flows.

**Key Functions:**
- `create_access_token(user)` - Generate 1-hour access tokens âœ…
- `create_refresh_token(user_id)` - Generate 30-day refresh tokens âœ…
- `verify_token(token, type)` - Validate and decode tokens âœ…
- `sanitize_string(input)` - Clean user input strings âœ…

**Features:**
- Configurable token expiry âœ…
- Secure JWT signing with HS256 âœ…
- Automatic token type validation âœ…
- Input sanitization for security âœ…

### `database.py` âœ… PRODUCTION READY
MongoDB connection and collection management.

**Key Features:**
- Async MongoDB client using Motor âœ…
- Automatic connection management âœ…
- Collection getter methods for users, refresh_tokens âœ…
- Connection cleanup utilities âœ…
- Event loop compatibility for serverless âœ…

**Collections Supported:**
- `users` - User profiles and authentication data âœ…
- `refresh_tokens` - Session management tokens âœ…
- Ready for future: `snippets`, `sessions` âœ…

### `response_utils.py` âœ… PRODUCTION READY
Standardized API response formatting.

**Response Format:**
```python
{
    "success": true,
    "message": "Operation successful", 
    "data": { ... }
}
```

**Functions:**
- `create_response(data, message)` - Success responses âœ…
- `create_error_response(message, status_code)` - Error responses âœ…

## ğŸš¨ Usage Rules

### The Sacred Laws (NEVER BREAK)
1. **Import Pattern** - Always use `sys.path.append('../shared')` âœ…
2. **No Business Logic** - Utilities only, no feature-specific code âœ…
3. **Consistent Patterns** - Same function signatures across all utilities âœ…
4. **Error Handling** - Always return meaningful error responses âœ…
5. **Stateless Functions** - No global state, no side effects âœ…

### Import Example
```python
# In any serverless function
import sys
sys.path.append('../shared')
from auth_utils import AuthUtils
from database import db
from response_utils import create_response, create_error_response
```

## âœ… Production Features

**Security:**
- JWT tokens with configurable expiry âœ…
- Input sanitization prevents injection attacks âœ…
- Secure token generation âœ…
- Proper error handling without information leakage âœ…

**Performance:**
- Async database operations âœ…
- Connection pooling and reuse âœ…
- Minimal memory footprint âœ…
- Fast token operations âœ…

**Reliability:**
- Comprehensive error handling âœ…
- Automated testing coverage âœ…
- Event loop compatibility âœ…
- Graceful failure modes âœ…

## ğŸ§ª Testing Coverage

All shared utilities have automated tests:
- **Authentication tests** - Token creation, verification, edge cases âœ…
- **Database tests** - Connection, collection access, cleanup âœ…
- **Response tests** - Format validation, error handling âœ…

**Test Location:** `../tests/auth/` (integrated with feature tests)

## ğŸ¯ Current Status

**Completed Utilities:** âœ… PRODUCTION READY
- Authentication (JWT tokens, validation, security) âœ…
- Database (MongoDB connection, collections, async operations) âœ…
- Response formatting (consistent API responses) âœ…

**Future Utilities:** ğŸš§ PLANNED
- Extended validation helpers
- Email/notification utilities
- File upload/storage helpers
- Logging and monitoring utils

---

**Remember**: Shared utilities should be boring and predictable. If it's exciting or clever, it probably doesn't belong here. ğŸ¯

*Simple utilities enable complex features. Complex utilities create simple bugs.*